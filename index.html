<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scan</title>
    <link rel = "stylesheet" href = "style.css">
    <script> 
    

    let lists = document.getElementsByClassName('list')
    let objs =[]
    let sim = []
    let count = 0
    // let jump = 0
    let totalCount = 0
    document.addEventListener('keydown', function(event) {
        if (event.key == 'Enter') {
            
            let a = document.getElementById('mainInput').value
                data = {
                    id: a
                }
            var options = {
                method: 'POST',
                body: JSON.stringify(data),
            
                headers: {
                    'Content-Type': 'application/json'
                }
            };
                
            fetch('http://localhost/see', options)
                .then((response) => {
                // console.log(response)
                // JSON.parse(response)
                return response.json();
            })
            .then((jsonObject) => {
                console.log(jsonObject)
                lists[count].innerHTML = jsonObject.Name + " в наличии: " + jsonObject.count + " покупали/продаем: " + jsonObject.buy + "/" + jsonObject.sell
                // objs[count] = jsonObject
                sim[count] = jsonObject.id
                objs.push(jsonObject)
                totalCount = totalCount + Number(jsonObject.sell)
                console.log(totalCount)
                console.log(objs)
                console.log(sim)
                document.getElementById('totalCount').innerHTML = totalCount
                count++
                // count = count + jump
                // jump = 0
                if (count == 24) {
                    count = 0
                }
                
            })
            
            document.getElementById('mainInput').value = ''
        }

    });

    function clear2(aa) {
        
        console.log("clear " + aa)
        lists[aa].innerHTML = '1'
        
        var index = null
        let counter = 0
        for (let x of objs) {
            if (x.id == sim[aa])  { 
                index = counter  
                break
            }
            counter++
        }
        totalCount = totalCount - objs[index].sell 
        document.getElementById('totalCount').innerHTML = totalCount
        objs[index] = 0
        sim[aa] = 0
        console.log(objs)
        console.log(sim)
        
        
    }

    function pay() {

        var sendArr = []

        for (var j of objs) {
            sendArr.push(j.id)
        }
        console.log(sendArr)
        var options = {
            method: 'POST',
            body: JSON.stringify(sendArr),
            
            headers: {
                'Content-Type': 'application/json'
            }
        };


        fetch('http://localhost/pay', options)
                .then((response) => {
                
            })
            
        
        count = 0    
        totalCount = 0
        objs = []
        sim = []
        for (let i of lists) {
            i.innerHTML = '1'
        }
        document.getElementById('totalCount').innerHTML = totalCount

        

    }

    function multiply(ab) {

        var val = prompt("SKOKA???")
        if (val == null || val == "") {
            alert("ERROR")
        } else {
            lists[ab].innerHTML = lists[ab].innerHTML + " x" + val
            let a = sim[ab]
            
            var index = null
            let counter = 0
            for (let x of objs) {
                if (x.id == sim[ab])  { 
                    index = counter  
                    break
                }
                counter++
            }

            for (let i = 0; i < val - 1; i++) {
                objs.push(objs[index])
            }
            console.log(objs)
            console.log(sim)
            totalCount = totalCount + (val - 1) * objs[index].sell
            document.getElementById('totalCount').innerHTML = totalCount
        }

    }

    function add() {
        var sendArr = []

        for (var j of objs) {
            sendArr.push(j.id)
        }
        console.log(sendArr)
        var options = {
            method: 'POST',
            body: JSON.stringify(sendArr),
    
            headers: {
                'Content-Type': 'application/json'
            }
        };


        fetch('http://localhost/add', options)
            .then((response) => {
        
            })
        count = 0    
        totalCount = 0
        objs = []
        sim = []
        for (let i of lists) {
            i.innerHTML = '1'
        }
        document.getElementById('totalCount').innerHTML = totalCount

        }   

        function report() {

            options = {
                method: 'GET'
            }
            fetch('http://localhost/report', options)
            .then((response) => {
                // console.log(response)
                // alert()
                return response.json()
            })
            .then((rep) => {
                console.log(rep)
                alert("Продано за сегодня: " + rep.todaysell + "\nПрофит за сегодня: " + (rep.todaysell - rep.todaybuy) + "\nПродано за все время: " + (rep.alltimesell) + "\nПрофит за все время: "  + (rep.alltimesell - rep.alltimebuy))
            })
        }

        function refresh() {
            options = {
                method: 'GET'
            }

            fetch('http://localhost/refresh', options)
            .then((res) => {
                
            })

        }

    </script>
</head>
<body>

    <div id = "leftside">
        <input type="text" id = "mainInput"> 
        <!-- <button onclick="fetchSee()"> LOL</button> -->
        <div id = "totalCount"> 0 </div>

        <button id = "oplatit" onclick="pay()"> Оплатить</button>
        <button id = "addTovar" onclick="add()"> Добавить Товар</button>
        <button id = "report" onclick ="report()"> Отчет </button>
        <button id = "refresh" onclick = "refresh()"> Обновить </button>
    </div>
    

    <div id = "rightside">
        <button class = "X" onclick="clear2(0)">X</button>
        <button class = "Y" onclick="multiply(0)">UMNOJIT</button>
        <div class = "list">
            1
        </div>
        
        <button class = "X" onclick="clear2(1)">X</button>
        <button class = "Y" onclick="multiply(1)">UMNOJIT</button>
        <div class = "list">
            1
        </div>
        <button class = "X" onclick="clear2(2)">X</button>
        <button class = "Y" onclick="multiply(2)">UMNOJIT</button>
        <div class = "list">
            1
        </div>
        <button class = "X" onclick="clear2(3)">X</button>
        <button class = "Y" onclick="multiply(3)">UMNOJIT</button>
        <div class = "list">
            1
        </div>
        <button class = "X" onclick="clear2(4)">X</button>
        <button class = "Y" onclick="multiply(4)">UMNOJIT</button>
        <div class = "list">
            1
        </div>
        <button class = "X" onclick="clear2(5)">X</button>
        <button class = "Y" onclick="multiply(5)">UMNOJIT</button>
        <div class = "list">
            1
        </div>
        <button class = "X" onclick="clear2(6)">X</button>
        <button class = "Y" onclick="multiply(6)">UMNOJIT</button>
        <div class = "list">
            1
        </div>
        <button class = "X" onclick="clear2(7)">X</button>
        <button class = "Y" onclick="multiply(7)">UMNOJIT</button>
        <div class = "list">
            1
        </div>
        <button class = "X" onclick="clear2(8)">X</button>
        <button class = "Y" onclick="multiply(8)">UMNOJIT</button>
        <div class = "list">
            1
        </div>
        <button class = "X" onclick="clear2(9)">X</button>
        <button class = "Y" onclick="multiply(9)">UMNOJIT</button>
        <div class = "list">
            1
        </div>
        <button class = "X" onclick="clear2(10)">X</button>
        <button class = "Y" onclick="multiply(10)">UMNOJIT</button>
        <div class = "list">
            1
        </div>
        <button class = "X" onclick="clear2(11)">X</button>
        <button class = "Y" onclick="multiply(11)">UMNOJIT</button>
        <div class = "list">
            1
        </div>
        <button class = "X" onclick="clear2(12)">X</button>
        <button class = "Y" onclick="multiply(12)">UMNOJIT</button>
        <div class = "list">
            1
        </div>
        <button class = "X"  onclick="clear2(13)">X</button>
        <button class = "Y" onclick="multiply(13)">UMNOJIT</button>
        <div class = "list">
            1
        </div>
        <button class = "X"  onclick="clear2(14)">X</button>
        <button class = "Y" onclick="multiply(14)">UMNOJIT</button>
        <div class = "list">
            1
        </div>
        <button class = "X"  onclick="clear2(15)">X</button>
        <button class = "Y" onclick="multiply(15)">UMNOJIT</button>
        <div class = "list">
            1
        </div>
        <button class = "X"  onclick="clear2(16)">X</button>
        <button class = "Y" onclick="multiply(16)">UMNOJIT</button>
        <div class = "list">
            1
        </div>
        <button class = "X"  onclick="clear2(17)">X</button>
        <button class = "Y" onclick="multiply(17)">UMNOJIT</button>
        <div class = "list">
            1
        </div>
        <button class = "X"  onclick="clear2(18)">X</button>
        <button class = "Y" onclick="multiply(18)">UMNOJIT</button>
        <div class = "list">
            1
        </div>
        <button class = "X"  onclick="clear2(19)">X</button>
        <button class = "Y" onclick="multiply(19)">UMNOJIT</button>
        <div class = "list">
            1
        </div>
        <button class = "X"  onclick="clear2(20)">X</button>
        <button class = "Y" onclick="multiply(20)">UMNOJIT</button>
        <div class = "list">
            1
        </div>
        <button class = "X"  onclick="clear2(21)">X</button>
        <button class = "Y" onclick="multiply(21)">UMNOJIT</button>
        <div class = "list">
            1
        </div>
        <button class = "X"  onclick="clear2(22)">X</button>
        <button class = "Y" onclick="multiply(22)">UMNOJIT</button>
        <div class = "list">
            1
        </div>
        <button class = "X"  onclick="clear2(23)">X</button>
        <button class = "Y" onclick="multiply(23)">UMNOJIT</button>
        <div class = "list">
            1
        </div>
        <button class = "X" onclick="clear2(24)">X</button>
        <button class = "Y" onclick="multiply(24)">UMNOJIT</button>
        <div class = "list">
            1
        </div>
  

    </div>

    
    
</body>
</html>